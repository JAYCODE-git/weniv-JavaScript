<!DOCTYPE html>
<html lang="ko">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ”¥fetch()</title>
</head>

<body>
    <script>
        'use strict';
        class UserStorage {

            // ìœ ì €ê°€ ë“±ë¡ë˜ì—ˆëŠ”ì§€ í™•ì¸
            async searchUser(userName, password) {
                // * await 
                // promise ê°ì²´ê°€ ë°˜í™˜ë  ë•Œê¹Œì§€ ë‹¤ìŒ ì½”ë“œì˜ ë™ì‘ì„ ì¤‘ì§€.
                // promise ê°ì²´ì˜ fulfilled ê°’ì„ ë°˜í™˜.
                // return await new Promise((resolve, reject) => {
                const response = await fetch('users.json');
                const data = await response.json();
                if (result) {
                    return userName;
                } else {
                    console.log(new Error('ğŸ¥² ì—†ëŠ” ìœ ì €'));
                }
                //     fetch('users.json')
                //         .then((data) => {
                //             // ì˜ˆì™¸ì²˜ë¦¬?ã…‹
                //             if (data.ok) {
                //                 return data.json()
                //             } else {
                //                 console.log(new Error('ğŸ”¥ ë„¤íŠ¸ì›Œí¬ ì‘ë‹µ ë¬¸ì œ!'));
                //             }
                //         })
                //         .then((response) => {
                //             const result = response.user.find((item) => {
                //                 return item.userName === userName && item.password === password
                //             });

                //             if (result) {
                //                 resolve(userName);
                //             } else {
                //                 reject('ğŸ¥² ì—†ëŠ” ìœ ì €!');
                //             }
                //         })
                // })
            }

            async sayHi(user) {
                // return await new Promise((resolve, reject) => {
                const response = await fetch('greetings.json');
                const data = await response.json();
                const result = response.greetings.find((item) => {
                    return item.userName === user
                });

                if (result) {
                    return {
                        name: result.userName,
                        greetings: result.speak
                    }
                } else {
                    console.log(new Error('ğŸ¥² ì¸ì‚¬í•  ìˆ˜ê°€ ì—†ë‹¤'));
                }

                //         .then((data) => {
                //     if (data.ok) {
                //         return data.json()
                //     } else {
                //         console.log(new Error('ğŸ”¥ sayHi fetch() Error!'));
                //     }
                // }).then((response) => {
                //     const result = response.greetings.find((item) => {
                //         return item.userName === user
                //     });

                //     if (result) {
                //         resolve(
                //             {
                //                 name: result.userName,
                //                 greetings: result.speak
                //             }
                //         );
                //     } else {
                //         // reject('no greetings');
                //         throw 'no greetings'
                //     }
                // })
                // })
            }
        }

        const userStorage = new UserStorage();

        const userName = prompt('ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”');
        const password = prompt('ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”');

        // ì¦‰ì‹œ ì‹¤í–‰ í•¨ìˆ˜ë¡œ async/await ì‚¬ìš©!
        try {
            (async function () {
                const user = await userStorage.searchUser(userName, password);
                const result = await userStorage.sayHi(user);
                alert(`ë‹¹ì‹ ì—ê²Œ ì¸ì‚¬í•©ë‹ˆë‹¤! ${result.name}ë‹˜ ${result.greetings}`);
            })();
        } catch {
            console.log(new Error('ğŸ”¥ catch() Error!'));
        }
    </script>

</body>

</html>